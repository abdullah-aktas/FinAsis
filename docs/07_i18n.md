# 7. Dil ve YerelleÅŸtirme (i18n)

## ğŸ“Œ AmaÃ§
Bu dokÃ¼mantasyon, FinAsis projesinin Ã§oklu dil desteÄŸi ve yerelleÅŸtirme Ã¶zelliklerini detaylandÄ±rmaktadÄ±r.

## âš™ï¸ Teknik YapÄ±

### 1. Dil DosyalarÄ±

#### 1.1. JSON TabanlÄ± Dil DosyalarÄ±
```json
// locale/tr/LC_MESSAGES/django.json
{
    "common": {
        "save": "Kaydet",
        "cancel": "Ä°ptal",
        "delete": "Sil",
        "edit": "DÃ¼zenle",
        "search": "Ara",
        "filter": "Filtrele"
    },
    "auth": {
        "login": "GiriÅŸ Yap",
        "logout": "Ã‡Ä±kÄ±ÅŸ Yap",
        "register": "KayÄ±t Ol",
        "password": "Åifre",
        "email": "E-posta"
    },
    "finance": {
        "invoice": "Fatura",
        "payment": "Ã–deme",
        "customer": "MÃ¼ÅŸteri",
        "amount": "Tutar",
        "date": "Tarih",
        "status": "Durum"
    }
}
```

#### 1.2. Dil YÃ¼kleyici
```python
# i18n/loader.py
import json
import os
from django.conf import settings

class LanguageLoader:
    def __init__(self):
        self.translations = {}
        self.default_language = settings.LANGUAGE_CODE
    
    def load_language(self, language_code):
        if language_code not in self.translations:
            file_path = os.path.join(
                settings.BASE_DIR,
                'locale',
                language_code,
                'LC_MESSAGES',
                'django.json'
            )
            
            try:
                with open(file_path, 'r', encoding='utf-8') as f:
                    self.translations[language_code] = json.load(f)
            except FileNotFoundError:
                self.translations[language_code] = {}
        
        return self.translations[language_code]
    
    def get_translation(self, key, language_code=None):
        language_code = language_code or self.default_language
        translations = self.load_language(language_code)
        
        keys = key.split('.')
        value = translations
        
        for k in keys:
            if isinstance(value, dict) and k in value:
                value = value[k]
            else:
                return key
        
        return value
```

### 2. Ã‡eviri Sistemi

#### 2.1. Django Entegrasyonu
```python
# settings.py
MIDDLEWARE = [
    'django.middleware.locale.LocaleMiddleware',
    # ...
]

LANGUAGES = [
    ('tr', 'TÃ¼rkÃ§e'),
    ('en', 'English'),
    ('ku', 'KurdÃ®'),
    ('ar', 'Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©'),
    ('de', 'Deutsch')
]

LOCALE_PATHS = [
    os.path.join(BASE_DIR, 'locale'),
]

# i18n/middleware.py
from django.utils import translation
from django.conf import settings

class LanguageMiddleware:
    def __init__(self, get_response):
        self.get_response = get_response
    
    def __call__(self, request):
        # KullanÄ±cÄ± tercihini kontrol et
        user_language = request.session.get('django_language')
        if user_language:
            translation.activate(user_language)
        
        response = self.get_response(request)
        return response
```

#### 2.2. Template KullanÄ±mÄ±
```html
<!-- templates/base.html -->
{% load i18n %}

<!DOCTYPE html>
<html lang="{{ LANGUAGE_CODE }}">
<head>
    <meta charset="UTF-8">
    <title>{% trans "FinAsis" %}</title>
</head>
<body>
    <nav>
        <select onchange="changeLanguage(this.value)">
            {% get_available_languages as LANGUAGES %}
            {% get_language_info_list for LANGUAGES as languages %}
            {% for language in languages %}
                <option value="{{ language.code }}"
                        {% if language.code == LANGUAGE_CODE %}selected{% endif %}>
                    {{ language.name_local }}
                </option>
            {% endfor %}
        </select>
    </nav>
    
    <main>
        {% block content %}{% endblock %}
    </main>
</body>
</html>
```

### 3. RTL DesteÄŸi

#### 3.1. CSS YapÄ±landÄ±rmasÄ±
```css
/* static/css/rtl.css */
[dir="rtl"] {
    /* Genel RTL stilleri */
    text-align: right;
}

[dir="rtl"] .navbar-nav {
    padding-right: 0;
}

[dir="rtl"] .dropdown-menu {
    text-align: right;
}

[dir="rtl"] .form-control {
    text-align: right;
}

/* RTL Ã¶zel bileÅŸen stilleri */
[dir="rtl"] .invoice-header {
    flex-direction: row-reverse;
}

[dir="rtl"] .payment-details {
    padding-right: 20px;
    padding-left: 0;
}
```

#### 3.2. JavaScript Entegrasyonu
```javascript
// static/js/rtl.js
class RTLManager {
    constructor() {
        this.rtlLanguages = ['ar', 'ku'];
    }
    
    isRTL(languageCode) {
        return this.rtlLanguages.includes(languageCode);
    }
    
    applyRTLSettings(languageCode) {
        const isRTL = this.isRTL(languageCode);
        document.documentElement.dir = isRTL ? 'rtl' : 'ltr';
        document.documentElement.lang = languageCode;
        
        // RTL CSS sÄ±nÄ±fÄ±nÄ± ekle/kaldÄ±r
        document.body.classList.toggle('rtl', isRTL);
    }
}

// Dil deÄŸiÅŸikliÄŸinde RTL ayarlarÄ±nÄ± uygula
function changeLanguage(languageCode) {
    const rtlManager = new RTLManager();
    rtlManager.applyRTLSettings(languageCode);
    
    // Dil deÄŸiÅŸikliÄŸi isteÄŸi gÃ¶nder
    fetch('/api/change-language/', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': getCookie('csrftoken')
        },
        body: JSON.stringify({ language: languageCode })
    }).then(() => {
        window.location.reload();
    });
}
```

## ğŸ”§ KullanÄ±m AdÄ±mlarÄ±

### 1. Yeni Dil Ekleme

#### 1.1. Dil DosyasÄ± OluÅŸturma
```bash
# Dil dizini oluÅŸtur
mkdir -p locale/tr/LC_MESSAGES
mkdir -p locale/en/LC_MESSAGES
mkdir -p locale/ku/LC_MESSAGES
mkdir -p locale/ar/LC_MESSAGES
mkdir -p locale/de/LC_MESSAGES

# Dil dosyalarÄ±nÄ± oluÅŸtur
touch locale/*/LC_MESSAGES/django.json
```

#### 1.2. Ã‡eviri Ekleme
```python
# i18n/management/commands/compile_messages.py
from django.core.management.base import BaseCommand
import json
import os

class Command(BaseCommand):
    help = 'Dil dosyalarÄ±nÄ± derle'
    
    def handle(self, *args, **options):
        locale_dir = 'locale'
        
        for lang_code in os.listdir(locale_dir):
            lang_path = os.path.join(locale_dir, lang_code)
            if os.path.isdir(lang_path):
                messages_path = os.path.join(
                    lang_path,
                    'LC_MESSAGES',
                    'django.json'
                )
                
                if os.path.exists(messages_path):
                    with open(messages_path, 'r', encoding='utf-8') as f:
                        messages = json.load(f)
                    
                    # Ã‡evirileri derle
                    compiled_path = messages_path.replace('.json', '.mo')
                    self.compile_messages(messages, compiled_path)
    
    def compile_messages(self, messages, output_path):
        # MesajlarÄ± derle ve kaydet
        pass
```

### 2. RTL DesteÄŸi Ekleme

#### 2.1. Template Entegrasyonu
```html
<!-- templates/base.html -->
{% load static %}
<!DOCTYPE html>
<html lang="{{ LANGUAGE_CODE }}" dir="{% if LANGUAGE_BIDI %}rtl{% else %}ltr{% endif %}">
<head>
    <link rel="stylesheet" href="{% static 'css/rtl.css' %}">
    <script src="{% static 'js/rtl.js' %}"></script>
</head>
<body class="{% if LANGUAGE_BIDI %}rtl{% endif %}">
    <!-- Sayfa iÃ§eriÄŸi -->
</body>
</html>
```

## ğŸ§ª Test Ã–rnekleri

### 1. Dil YÃ¼kleyici Testi
```python
# tests/test_i18n.py
from django.test import TestCase
from i18n.loader import LanguageLoader

class LanguageLoaderTest(TestCase):
    def setUp(self):
        self.loader = LanguageLoader()
    
    def test_load_language(self):
        translations = self.loader.load_language('tr')
        self.assertIn('common', translations)
        self.assertIn('save', translations['common'])
    
    def test_get_translation(self):
        translation = self.loader.get_translation('common.save', 'tr')
        self.assertEqual(translation, 'Kaydet')
```

### 2. RTL YÃ¶netici Testi
```javascript
// tests/rtl.test.js
describe('RTLManager', () => {
    let rtlManager;
    
    beforeEach(() => {
        rtlManager = new RTLManager();
    });
    
    test('should detect RTL languages', () => {
        expect(rtlManager.isRTL('ar')).toBe(true);
        expect(rtlManager.isRTL('en')).toBe(false);
    });
    
    test('should apply RTL settings', () => {
        rtlManager.applyRTLSettings('ar');
        expect(document.documentElement.dir).toBe('rtl');
        expect(document.body.classList.contains('rtl')).toBe(true);
    });
});
```

## ğŸ“ SÄ±k KarÅŸÄ±laÅŸÄ±lan Sorunlar ve Ã‡Ã¶zÃ¼mleri

### 1. Ã‡eviri Eksiklikleri
**Sorun**: BazÄ± metinler Ã§evrilmemiÅŸ
**Ã‡Ã¶zÃ¼m**:
- Eksik Ã§evirileri kontrol edin
- VarsayÄ±lan dil dosyasÄ±nÄ± gÃ¼ncelleyin
- Ã‡eviri anahtarlarÄ±nÄ± doÄŸrulayÄ±n

### 2. RTL GÃ¶rÃ¼nÃ¼m SorunlarÄ±
**Sorun**: RTL dillerde gÃ¶rÃ¼nÃ¼m bozuk
**Ã‡Ã¶zÃ¼m**:
- CSS Ã¶zelliklerini kontrol edin
- Flexbox yÃ¶nlendirmelerini dÃ¼zeltin
- Margin/padding deÄŸerlerini ayarlayÄ±n

### 3. Dil DeÄŸiÅŸtirme HatalarÄ±
**Sorun**: Dil deÄŸiÅŸikliÄŸi Ã§alÄ±ÅŸmÄ±yor
**Ã‡Ã¶zÃ¼m**:
- Session ayarlarÄ±nÄ± kontrol edin
- Middleware sÄ±rasÄ±nÄ± doÄŸrulayÄ±n
- TarayÄ±cÄ± Ã¶nbelleÄŸini temizleyin

## ğŸ“‚ Dosya YapÄ±sÄ± ve Referanslar

```
finasis/
â”œâ”€â”€ locale/
â”‚   â”œâ”€â”€ tr/
â”‚   â”‚   â””â”€â”€ LC_MESSAGES/
â”‚   â”‚       â””â”€â”€ django.json
â”‚   â”œâ”€â”€ en/
â”‚   â”‚   â””â”€â”€ LC_MESSAGES/
â”‚   â”‚       â””â”€â”€ django.json
â”‚   â””â”€â”€ ...
â”œâ”€â”€ static/
â”‚   â”œâ”€â”€ css/
â”‚   â”‚   â””â”€â”€ rtl.css
â”‚   â””â”€â”€ js/
â”‚       â””â”€â”€ rtl.js
â””â”€â”€ i18n/
    â”œâ”€â”€ loader.py
    â”œâ”€â”€ middleware.py
    â””â”€â”€ management/
        â””â”€â”€ commands/
            â””â”€â”€ compile_messages.py
```

## ğŸ” Ek Kaynaklar

- [Django i18n DokÃ¼mantasyonu](https://docs.djangoproject.com/en/stable/topics/i18n/)
- [RTL Stil Rehberi](https://rtlstyling.com/)
- [Unicode CLDR](http://cldr.unicode.org/)
- [Bidi Algorithm](https://www.w3.org/International/articles/inline-bidi-markup/) 